
# Pin Definitions
# Pin 13: Dig Output - IN2 on Relay - Set to Low means R Thruster and Battery are connected
in2 = 13
# Pin 16: Dig Output - IN1 on Relay - Set to Low means L Thruster and Battery are connected
in1 = 16
# Pin 15: PWM Output - Controls Right Thruster
r_thrust_pwm = 15
# Pin 18: PWM Output - Controls Left Thruster
l_thrust_pwm = 18

# Imports
import RPi.GPIO as GPIO
import time

# Initial GPIO Setup
GPIO.setmode(GPIO.BOARD)
GPIO.setup(in2, GPIO.OUT, initial=GPIO.LOW)
GPIO.setup(in1, GPIO.OUT, initial=GPIO.LOW)
GPIO.setup(r_thrust_pwm, GPIO.OUT, initial=GPIO.LOW)
GPIO.setup(l_thrust_pwm, GPIO.OUT, initial=GPIO.LOW)


class Thrusters: 
	# right_speed and left_speed should be initiated at 1500, which is neuteral
	# 1500 = neuteral
	# 1100 = max reverse
	# 1900 = max ahead
	p_r = GPIO.PWM(r_thrust_pwm, 50)
	p_l = GPIO.PWM(l_thrust_pwm, 50)
	def __init__(thrusters, right_speed, left_speed):
		thrusters.right_speed = right_speed
		thrusters.left_speed = left_speed
		thrusters.changeSpeed(right_speed, left_speed)
		
	def changeSpeed(thrusters, right_speed, left_speed):
		# Change right thruster to set value
		thrusters.right_speed = right_speed
		thrusters.p_r.start(right_speed/200)
		
		# Change left thruster to set value
		thrusters.left_speed = left_speed
		thrusters.p_l.start(left_speed/200)
		
	def stop(thrusters):
		thrusters.p_r.stop()
		thrusters.p_l.stop()
		
def main():
	# Initialize the thrusters in neuteral
	print("Neuteral Thrusters")
	thrusters = Thrusters(1500, 1500)
	time.sleep(10)
	
	# Standard Foward
	print("Standard Forward")
	thrusters.changeSpeed(1650, 1650)
	time.sleep(10)
	
	# Standard Reverse
	print("Standard Reverse")
	thrusters.changeSpeed(1350, 1350)
	time.sleep(10)
	
	# Disconnect
	print("Stop Thrusters")
	thrusters.stop()
	
	GPIO.cleanup()

if __name__ == '__main__':
    main()		